import pygame
from duality import color
from duality import player
from duality import block

__author__ = 'mcprog'

# inits all of the pygame modules
print(pygame.init())  # returns a tuple that says whether successfully

gameDisplay = pygame.display.set_mode((1024, 640))
pygame.display.set_caption('Duality')

FPS = 60
WALK_SPEED = 5
RUN_SPEED = 10
AIR_SPEED = 4
AIR_ROLL_SPEED = 7
GRAVITY = .05
mx = 0
my = 0
dx = WALK_SPEED
vx = AIR_SPEED
dy = GRAVITY
left = False
right = False
pygame.display.update()  # init update

# game loop
runGame = True
clock = pygame.time.Clock()

player = player.Player(0, 0)

#32 columns, 20 rows
level1 = [
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],

    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],

    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],

    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],

    [1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0],
    [1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1]
]

blockList = []

for y in range(0, len(level1)):
    for x in range(0, len(level1[y])):
        if (level1[y][x] == 1):
            blockList.append(block.Block(x*32, y*32))

while runGame:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            runGame = False
            break
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_a:
                left = True
            if event.key == pygame.K_d:
                right = True
            if event.key == pygame.K_LSHIFT:
                if player.onGround:
                    vx = RUN_SPEED
                else:
                    vx = AIR_ROLL_SPEED
            if event.key == pygame.K_SPACE:
                player.jump(-2)
        elif event.type == pygame.KEYUP:
            if event.key == pygame.K_a:
                left = False
            if event.key == pygame.K_d:
                right = False
            if event.key == pygame.K_LSHIFT:
                if player.onGround:
                    vx = WALK_SPEED
                else:
                    vx = AIR_SPEED
    if left and not right:
        player.move(-vx)
    elif right and not left:
        player.move(vx)
    my += dy
    gameDisplay.fill(color.GRAY75)
    #pygame.draw.rect(gameDisplay, color.YELLOW, [mx, my, 64, 64])
    player.update(GRAVITY, blockList)

    for block in blockList:
        block.render(gameDisplay)

    player.render(gameDisplay)
    pygame.display.update()

    clock.tick(FPS)

pygame.quit()  # quits pygame
quit()  # quits python
